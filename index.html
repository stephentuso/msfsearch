
<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="js/jquery-3.0.0.min.js"></script>
    <script type="text/javascript" src="bower_components/double-metaphone/index.js"></script>
    <script type="text/javascript" src="js/fuse.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/simple-excel.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- <link rel="stylesheet" href="css/main.css"> -->
</head>
<body>
    <div class="container">
        <div class="row" id="topheader">
            <div class="align-center">
                <img src="dwb.jpg" id="dwbimage" class="img-responsive center-block logo">
            </div>
        </div>
        <div class="row">
            <div id="mainBox" class="align-center">
                <label class="btn btn-danger center-block" id="filebutton">
                    Select Files
                    <input type="file" style="display: none;" id="files" value="Select File">
                </label>
            </div>
        </div>
        <div class="row">
            <ul class="align-center" id="fileList">

            </ul>
        </div>
    </div>
    <script>
        var allData = [];
        var file_list = []
        function handleFileSelect(evt) {
            var files = evt.target.files; // FileList object
            file_list = file_list.concat(files)

            for (var i = 0; i < files.length; i++) {
                var text = $("<li class='text-center'><button class='glyphicon glyphicon-remove' onclick='deleteFile(event)'></button>&nbsp;"+ files[i].name + "</li>").hide()
                console.log(file_list)
                $('#fileList').append(text);
                text.fadeIn(500);
                (function(index) {
                    parseCsvFile(files[index], function(data) {
                        console.log(data);
                        allData = allData.concat(data);
                        if (index == files.length - 1) {
                            doneProcessing();
                        }
                    });
                })(i);
            }
        }

        function doneProcessing() {
            window.localStorage.setItem("allData", allData);
            console.log("DONE");
            processFiles(files);
        }

        document.getElementById('files').addEventListener('change', handleFileSelect, false);
        function deleteFile(event) {
            console.log("remove clicked")
            console.log(event.target)
            var remove_name = $(event.target).parent().text()
            $(event.target).parent().fadeOut(500)
            for (var i=0; i<file_list.length; i ++) {
                if (file_list[i].name == remove_name) {
                    file_list.splice(i, 1)
                }
            }
        }
    </script>
</body>
</html>
